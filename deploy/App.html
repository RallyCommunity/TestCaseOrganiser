<!DOCTYPE html>
<html>
<head>
    <title>bognuts</title>

    <script type="text/javascript" src="/apps/2.0rc3/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",layout:"hbox",align:"stretch",margin:10,items:[{xtype:"container",id:"folderbox"},{xtype:"container",id:"casebox",flex:2}],launch:function(){var tree=Ext.create("Rally.ui.tree.TestTree",{config:{displayedFields:["Name","Project"],topLevelModel:Ext.identityFn("TestFolder")},topLevelStoreConfig:{fetch:["FormattedID","Name","Parent","Children","TestCases","Project"],sorters:[],context:{projectScopeUp:!0,projectScopeDown:!0}},childItemsStoreConfigForParentRecordFn:function(){return{fetch:["FormattedID","Name","Parent","Children","TestCases","Project","TestFolder"],sorters:[],context:{projectScopeUp:!0,projectScopeDown:!0}}}});Ext.util.Observable.capture(tree,function(event){console.log(event,arguments)}),Ext.getCmp("folderbox").add(tree);var cases=Ext.create("Rally.ui.tree.TestTree",{config:{displayedFields:["Name","Project"],topLevelModel:Ext.identityFn("TestCase"),topLevelParentAttribute:"TestFolder"}});Ext.getCmp("casebox").add(cases)}}),Ext.define("testTreeItem",{extend:"Rally.ui.tree.TreeItem",alias:"widget.testTreeItem",getContentTpl:function(){var me=this;return Ext.create("Ext.XTemplate",'<tpl if="this.canDrag()"><div class="icon drag"></div></tpl>',"{[this.getActionsGear()]}",'<div class="textContent ellipses">{[this.getFormattedId()]} {[this.getSeparator()]}{Name}  ({Project.Name})</div>','<div class="rightSide">',"</div>",{canDrag:function(){return me.getCanDrag()},getActionsGear:function(){return me._buildActionsGearHtml()},getFormattedId:function(){var record=me.getRecord();return record.getField("FormattedID")?Rally.ui.renderer.RendererFactory.renderRecordField(record,"FormattedID"):""},getSeparator:function(){return this.getFormattedId()?"- ":""}})}}),Ext.define("Rally.ui.tree.TestTree",{extend:Rally.ui.tree.Tree,alias:"widget.rallytesttree",constructor:function(config){config=Ext.apply({childModelTypeForRecordFn:this.childModelTypeForRecordFn,givenAParentRecordWhatIsTheAttributeConnectingAChildToThisParentFn:this.givenAParentRecordWhatIsTheAttributeConnectingAChildToThisParent,givenAChildRecordWhatIsTheAttributeConnectingItToTheParentFn:this.givenAChildRecordWhatIsTheAttributeConnectingItToTheParent,givenAChildAndParentRecordWhatAttributeShouldConnectTheChildToTheParentFn:this.givenAChildAndParentRecordWhatAttributeShouldConnectTheChildToTheParent,canExpandFn:this.canExpandItem,enableRanking:!0,enableDragAndDrop:!0,dragDropGroupFn:this.dragDropGroup,dragThisGroupOnMeFn:this.dragThisGroupOnMe,scope:this,treeItemConfigForRecordFn:this.treeItemConfigForRecordFn,listeners:{beforerecordsaved:this.beforeRecordSaved,recordsaved:function(record,listeners){}}},config),this.callParent([config])},treeItemConfigForRecordFn:function(record){var config={selectable:!0};return config.xtype=this._isTestFolder(record)?"testTreeItem":"rallytreeitem",config},beforeRecordSaved:function(record,newParentRecord){this._isTestFolder(newParentRecord)?record.set("Project",newParentRecord.get("Project")):this._isTestCase(newParentRecord)&&(record.set("Project",newParentRecord.get("Project")),record.set("TestFolder",newParentRecord.get("TestFolder")))},_isTestFolder:function(record){return"testfolder"===record.get("_type")},_isTestCase:function(record){return"testcase"===record.get("_type")},childModelTypeForRecordFn:function(record){return this._testFolderHasChildren(record)?"testfolder":"testcase"},givenAChildAndParentRecordWhatAttributeShouldConnectTheChildToTheParent:function(childRecord,parentRecord){return this._isTestCase(childRecord)?"TestFolder":this._isTestFolder(childRecord)?"Parent":void 0},givenAChildRecordWhatIsTheAttributeConnectingItToTheParent:function(childRecord){return this._isTestCase(childRecord)?"TestFolder":"Parent"},givenAParentRecordWhatIsTheAttributeConnectingAChildToThisParent:function(record){return this._testFolderHasChildren(record)?"Parent":"TestFolder"},canExpandItem:function(record){return this._testFolderHasChildren(record)||this._testFolderHasTestCases(record)},dragDropGroup:function(record){return Rally.util.Ref.getOidFromRef(record.get("_type"))},dragThisGroupOnMe:function(record){var workspace=Rally.util.Ref.getOidFromRef(record.get("Workspace")._ref);return this._isTestCase(record)?"testcase":this._isTestFolder(record)?["testcase","testfolder"]:void 0},_testFolderHasTestCases:function(record){return record.get("TestCases")&&record.get("TestCases").Count>0},_testFolderHasChildren:function(record){return record.get("Children")&&record.get("Children").Count>0}});

            Rally.launchApp('CustomApp', {
                name:"bognuts",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
